<!DOCTYPE html>
<html lang="en" data-multilingual="true">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Payment Calculator - Amortization Schedule | FinCalc</title>
    <meta name="description" content="Calculate loan payments, view amortization schedule, compare loan offers with different rates and terms.">
    <link rel="icon" href="../favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="../assets/styles-modern.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../assets/i18n.js" defer></script>
    <style>
        .full-calc-page { max-width: 1200px; margin: 0 auto; padding: var(--space-xl); }
        .full-calc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xl); flex-wrap: wrap; gap: var(--space-md); }
        .full-calc-header h1 { margin: 0; font-size: 1.75rem; display: flex; align-items: center; gap: var(--space-md); }
        .back-link { display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); text-decoration: none; font-weight: 500; padding: 0.5rem 1rem; border-radius: var(--radius-md); border: 1px solid var(--border); transition: all 0.2s; }
        .back-link:hover { background: var(--gray-100); color: var(--warning); border-color: var(--warning); }
        .back-link svg { width: 18px; height: 18px; }
        .calc-grid { display: grid; grid-template-columns: 1fr 400px; gap: var(--space-xl); }
        @media (max-width: 1024px) { .calc-grid { grid-template-columns: 1fr; } }
        .results-panel { background: linear-gradient(135deg, rgba(255, 152, 0, 0.04) 0%, rgba(244, 67, 54, 0.04) 100%); border: 1px solid var(--border); border-radius: var(--radius-xl); padding: var(--space-xl); }
        .form-panel { display: flex; flex-direction: column; gap: var(--space-lg); }
        .result-card--loan .result-card__icon { background: rgba(255, 152, 0, 0.15); color: var(--warning); }
        .calc-icon-loan { color: var(--warning); }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <a href="../index.html" class="logo">
                    <svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="32" height="32" rx="8" fill="url(#gradient)"/>
                        <path d="M9 22L13 16L17 18L23 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="23" cy="10" r="2" fill="white"/>
                        <defs><linearGradient id="gradient" x1="0" y1="0" x2="32" y2="32"><stop stop-color="#0066ff"/><stop offset="1" stop-color="#00a86b"/></linearGradient></defs>
                    </svg>
                    <span>FinCalc</span>
                </a>
                <nav class="nav-menu header-tabs">
                    <a href="../index.html#calculators" class="header-tab" data-i18n="nav.allCalculators">All Calculators</a>
                    <a href="../index.html#news" class="header-tab" data-i18n="nav.news">News</a>
                    <a href="../index.html#articles" class="header-tab" data-i18n="nav.articles">Articles</a>
                    <a href="../index.html#compare" class="header-tab" data-i18n="nav.compare">Compare</a>
                </nav>
                    <div class="lang-dropdown">
                        <button class="lang-dropdown-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                            <span class="lang-btn-text" data-i18n="nav.language">Language</span>
                        </button>
                        <div class="lang-dropdown-content">
                            <a href="#" onclick="i18n.setLanguage('en'); return false;">English</a>
                            <a href="#" onclick="i18n.setLanguage('pl'); return false;">Polski</a>
                            <a href="#" onclick="i18n.setLanguage('ru'); return false;">–†—É—Å—Å–∫–∏–π</a>
                        </div>
                    </div>
            </div>
        </div>
    </header>
    
    <main class="page-surface">
        <div class="full-calc-page">
            <div class="full-calc-header">
                <h1>
                    <svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" class="calc-icon-loan"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M7 15h0M2 9.5h20"/></svg>
                    <span data-i18n="calc.loan">Loan Payment Calculator</span>
                    <span class="badge badge--live" style="background: var(--warning); color: white;"><span class="badge__dot"></span>Pro</span>
                </h1>
                <a href="../index.html" class="back-link">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
                    <span data-i18n="nav.home">Back to Home</span>
                </a>
    </div>
    
            <div class="calc-grid">
                <!-- Results Panel -->
                <div class="results-panel">
                    <div class="result-cards" style="margin-bottom: var(--space-xl);">
                        <div class="result-card result-card--primary result-card--loan">
                            <div class="result-card__icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div>
                            <div class="result-card__content">
                                <span class="result-card__label" data-i18n="result.monthlyPayment">Monthly Payment</span>
                                <span class="result-card__value" id="result-monthly">‚ÇΩ0</span>
            </div>
        </div>
                        <div class="result-card">
                            <div class="result-card__icon result-card__icon--blue"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M16 8l-4 4-4-4"/><path d="M12 16V8"/></svg></div>
                            <div class="result-card__content">
                                <span class="result-card__label" data-i18n="result.totalAmount">Total Amount</span>
                                <span class="result-card__value" id="result-total">‚ÇΩ0</span>
        </div>
                    </div>
                        <div class="result-card">
                            <div class="result-card__icon result-card__icon--red"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg></div>
                            <div class="result-card__content">
                                <span class="result-card__label" data-i18n="result.totalInterest">Total Interest</span>
                                <span class="result-card__value result-card__value--danger" id="result-interest">‚ÇΩ0</span>
                    </div>
                </div>
                        <div class="result-card">
                            <div class="result-card__icon result-card__icon--green"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div>
                            <div class="result-card__content">
                                <span class="result-card__label" data-i18n="result.payoffDate">Payoff Date</span>
                                <span class="result-card__value" id="result-date">-</span>
                        </div>
                    </div>
                </div>
                
                    <div class="chart-section">
                        <div class="chart-header">
                            <h3 data-i18n="chart.amortization">Amortization</h3>
                            <div class="chart-legend">
                                <span class="legend-item"><span class="legend-dot legend-dot--invested"></span> <span data-i18n="table.principal">Principal</span></span>
                                <span class="legend-item"><span class="legend-dot legend-dot--interest"></span> <span data-i18n="table.interest">Interest</span></span>
                        </div>
                    </div>
                        <div class="chart-container"><canvas id="amort-chart"></canvas></div>
                </div>
                
                    <!-- Payment Breakdown Pie -->
                    <div class="chart-section" style="margin-top: var(--space-xl);">
                        <div class="chart-header"><h3 data-i18n="chart.breakdown">Payment Breakdown</h3></div>
                        <div class="chart-container" style="max-width: 300px; margin: 0 auto;"><canvas id="pie-chart"></canvas></div>
                    </div>
                </div>
                
                <!-- Form Panel -->
                <div class="form-panel">
                    <div class="form-card">
                        <div class="form-card__header">
                            <h3 data-i18n="section.loan">Loan Details</h3>
                            <button class="btn-reset" id="btn-reset" title="Reset"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg></button>
                </div>
                
                        <div class="form-group">
                            <label data-i18n="form.loanAmount">Loan Amount</label>
                            <div class="input-with-currency"><input type="text" id="loan-amount" value="500 000" inputmode="numeric"><span class="currency-symbol">‚ÇΩ</span></div>
                            <input type="range" id="loan-amount-range" min="10000" max="50000000" value="500000" step="10000">
            </div>
            
                        <div class="form-group">
                            <label data-i18n="form.interestRate">Interest Rate (%)</label>
                            <div class="input-with-suffix"><input type="text" id="interest-rate" value="18" inputmode="decimal"><span class="input-suffix">%</span></div>
                            <input type="range" id="interest-rate-range" min="0" max="40" value="18" step="0.1">
                </div>
                
                        <div class="form-row-2">
                            <div class="form-group">
                                <label data-i18n="form.loanTerm">Term</label>
                                <input type="number" id="term" value="24" min="1" max="360">
                        </div>
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <select id="term-unit">
                                    <option value="months" data-i18n="form.months" selected>Months</option>
                                    <option value="years" data-i18n="form.years">Years</option>
                                </select>
                    </div>
                    </div>
                    
                        <div class="form-group">
                            <label data-i18n="form.paymentType">Payment Type</label>
                            <select id="payment-type">
                                <option value="annuity" data-i18n="payment.annuity" selected>Annuity (fixed)</option>
                                <option value="differentiated" data-i18n="payment.differentiated">Differentiated</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-card form-card--collapsible">
                        <button class="form-card__toggle" id="toggle-extra">
                            <h3 data-i18n="section.extra">Extra Payments</h3>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                        <div class="form-card__content" id="extra-content" style="display:none;">
                            <div class="form-group">
                                <label data-i18n="form.extraMonthly">Extra Monthly Payment</label>
                                <div class="input-with-currency"><input type="text" id="extra-payment" value="0" inputmode="numeric"><span class="currency-symbol">‚ÇΩ</span></div>
                                <input type="range" id="extra-payment-range" min="0" max="100000" value="0" step="1000">
                </div>
            </div>
        </div>
        
                    <div class="presets-card">
                        <h4 data-i18n="form.quickPresets">Quick Presets</h4>
                        <div class="preset-buttons">
                            <button class="preset-btn" data-rate="7" data-currency="USD"><span class="preset-flag">üá∫üá∏</span><span>USD 7%</span></button>
                            <button class="preset-btn" data-rate="5" data-currency="EUR"><span class="preset-flag">üá™üá∫</span><span>EUR 5%</span></button>
                            <button class="preset-btn" data-rate="9" data-currency="PLN"><span class="preset-flag">üáµüá±</span><span>PLN 9%</span></button>
                            <button class="preset-btn active" data-rate="18" data-currency="RUB"><span class="preset-flag">üá∑üá∫</span><span>RUB 18%</span></button>
            </div>
        </div>
            </div>
        </div>
        
        <!-- Amortization Table -->
            <section class="breakdown-section" style="margin-top: var(--space-xl);">
                <div class="section-header">
                    <h2 data-i18n="section.schedule">Amortization Schedule</h2>
                    <div class="view-toggle">
                        <button class="view-btn active" data-view="yearly" data-i18n="button.yearly">Yearly</button>
                        <button class="view-btn" data-view="monthly" data-i18n="button.monthly">Monthly</button>
                </div>
            </div>
                <div class="table-container">
                    <table class="breakdown-table" id="breakdown-table">
                    <thead>
                        <tr>
                                <th data-i18n="table.period">Period</th>
                            <th data-i18n="table.payment">Payment</th>
                            <th data-i18n="table.principal">Principal</th>
                            <th data-i18n="table.interest">Interest</th>
                                <th data-i18n="table.balance">Balance</th>
                        </tr>
                    </thead>
                        <tbody id="breakdown-body"></tbody>
                </table>
            </div>
            </section>
    </div>
    
        <footer class="site-footer" style="margin-top: var(--space-2xl);">
        <div class="container">
                <p>&copy; 2025 FinCalc. <span data-i18n="footer.disclaimer">Financial calculators for informational purposes only</span></p>
        </div>
    </footer>
    </main>
    
    <script>
    (function() {
        'use strict';
        
        let amortChart = null, pieChart = null;
        let currentCurrency = '‚ÇΩ';
        const currencies = { USD: '$', EUR: '‚Ç¨', PLN: 'z≈Ç', RUB: '‚ÇΩ' };
        let scheduleData = [];
        
        function formatCurrency(num, currency = currentCurrency) {
            const formatted = new Intl.NumberFormat('ru-RU', { maximumFractionDigits: 0 }).format(Math.abs(num));
            return `${currency}${formatted}`;
        }
        
        function parseNumber(str) {
            return parseFloat((str || '').toString().replace(/\s|\u00A0/g, '').replace(',', '.')) || 0;
        }
        
        function formatInput(value) {
            return new Intl.NumberFormat('ru-RU').format(Math.round(value));
        }
        
        function calculate() {
            const loanAmount = parseNumber(document.getElementById('loan-amount').value);
            const rate = parseNumber(document.getElementById('interest-rate').value);
            const term = parseNumber(document.getElementById('term').value);
            const termUnit = document.getElementById('term-unit').value;
            const paymentType = document.getElementById('payment-type').value;
            const extraPayment = parseNumber(document.getElementById('extra-payment').value);
            
            const months = termUnit === 'years' ? term * 12 : term;
            const monthlyRate = rate / 100 / 12;
            
            scheduleData = [];
            let balance = loanAmount;
            let totalInterest = 0;
            let totalPayments = 0;
            
            let monthlyPayment = 0;
            if (paymentType === 'annuity' && monthlyRate > 0) {
                monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
            } else if (paymentType === 'annuity') {
                monthlyPayment = loanAmount / months;
            }
            
            const chartLabels = [];
            const principalData = [];
            const interestDataChart = [];
            
            for (let m = 1; m <= months && balance > 0; m++) {
                const interestPart = balance * monthlyRate;
                let principalPart, payment;
                
                if (paymentType === 'annuity') {
                    principalPart = monthlyPayment - interestPart;
                    payment = monthlyPayment;
                } else {
                    principalPart = loanAmount / months;
                    payment = principalPart + interestPart;
                }
                
                // Apply extra payment
                principalPart += extraPayment;
                payment += extraPayment;
                
                if (principalPart > balance) {
                    principalPart = balance;
                    payment = principalPart + interestPart;
                }
                
                balance -= principalPart;
                if (balance < 0) balance = 0;
                
                totalInterest += interestPart;
                totalPayments += payment;
                
                scheduleData.push({ period: m, payment, principal: principalPart, interest: interestPart, balance });
                
                chartLabels.push(`${m}–º`);
                principalData.push(principalPart);
                interestDataChart.push(interestPart);
            }
            
            const firstPayment = scheduleData.length > 0 ? scheduleData[0].payment : 0;
            const payoffDate = new Date();
            payoffDate.setMonth(payoffDate.getMonth() + scheduleData.length);
            
            document.getElementById('result-monthly').textContent = formatCurrency(firstPayment);
            document.getElementById('result-total').textContent = formatCurrency(totalPayments);
            document.getElementById('result-interest').textContent = formatCurrency(totalInterest);
            document.getElementById('result-date').textContent = payoffDate.toLocaleDateString('ru-RU', { year: 'numeric', month: 'short' });
            
            updateCharts(chartLabels, principalData, interestDataChart, loanAmount, totalInterest);
            updateTable();
        }
        
        function updateCharts(labels, principal, interest, loanAmt, totalInt) {
            // Amortization chart
            const ctx1 = document.getElementById('amort-chart');
            if (ctx1) {
                const config = {
                    type: 'bar',
                    data: {
                        labels: labels.filter((_, i) => i % 3 === 0 || i === labels.length - 1),
                        datasets: [
                            { label: 'Principal', data: principal.filter((_, i) => i % 3 === 0 || i === principal.length - 1), backgroundColor: 'rgba(255, 152, 0, 0.8)' },
                            { label: 'Interest', data: interest.filter((_, i) => i % 3 === 0 || i === interest.length - 1), backgroundColor: 'rgba(244, 67, 54, 0.6)' }
                        ]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { x: { stacked: true, grid: { display: false } }, y: { stacked: true } }
                    }
                };
                if (amortChart) { amortChart.data = config.data; amortChart.update('none'); }
                else { amortChart = new Chart(ctx1, config); }
            }
            
            // Pie chart
            const ctx2 = document.getElementById('pie-chart');
            if (ctx2) {
                const pieConfig = {
                    type: 'doughnut',
                    data: {
                        labels: ['Principal', 'Interest'],
                        datasets: [{ data: [loanAmt, totalInt], backgroundColor: ['rgba(255, 152, 0, 0.8)', 'rgba(244, 67, 54, 0.6)'], borderWidth: 0 }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
                };
                if (pieChart) { pieChart.data = pieConfig.data; pieChart.update('none'); }
                else { pieChart = new Chart(ctx2, pieConfig); }
            }
        }
        
        function updateTable() {
            const tbody = document.getElementById('breakdown-body');
            const viewBtn = document.querySelector('.view-btn.active');
            const isYearly = viewBtn && viewBtn.dataset.view === 'yearly';
            
            let filtered = isYearly ? scheduleData.filter((_, i) => (i + 1) % 12 === 0 || i === scheduleData.length - 1) : scheduleData;
            
            tbody.innerHTML = filtered.map(row => `<tr>
                <td>${isYearly ? Math.ceil(row.period / 12) + ' –≥.' : row.period + ' –º.'}</td>
                <td>${formatCurrency(row.payment)}</td>
                <td>${formatCurrency(row.principal)}</td>
                <td class="text-danger">${formatCurrency(row.interest)}</td>
                <td><strong>${formatCurrency(row.balance)}</strong></td>
            </tr>`).join('');
        }
        
        function setupInputs() {
            ['loan-amount', 'interest-rate', 'extra-payment'].forEach(id => {
                const input = document.getElementById(id);
                const range = document.getElementById(id + '-range');
                if (!input || !range) return;
                
                input.addEventListener('input', () => { range.value = parseNumber(input.value); calculate(); });
                range.addEventListener('input', () => {
                    input.value = id === 'interest-rate' ? range.value : formatInput(range.value);
                    calculate();
                });
            });
            
            ['term', 'term-unit', 'payment-type'].forEach(id => {
                const el = document.getElementById(id);
                if (el) { el.addEventListener('change', calculate); el.addEventListener('input', calculate); }
            });
            
            document.getElementById('btn-reset').addEventListener('click', () => {
                document.getElementById('loan-amount').value = '500 000';
                document.getElementById('loan-amount-range').value = 500000;
                document.getElementById('interest-rate').value = '18';
                document.getElementById('interest-rate-range').value = 18;
                document.getElementById('term').value = '24';
                document.getElementById('term-unit').value = 'months';
                document.getElementById('payment-type').value = 'annuity';
                document.getElementById('extra-payment').value = '0';
                document.getElementById('extra-payment-range').value = 0;
                currentCurrency = '‚ÇΩ';
                document.querySelectorAll('.currency-symbol').forEach(el => el.textContent = '‚ÇΩ');
                document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                document.querySelector('.preset-btn[data-currency="RUB"]').classList.add('active');
                calculate();
            });
            
            document.querySelectorAll('.form-card__toggle').forEach(btn => {
                btn.addEventListener('click', () => {
                    const content = btn.nextElementSibling;
                    const isOpen = content.style.display !== 'none';
                    content.style.display = isOpen ? 'none' : 'block';
                    btn.classList.toggle('open', !isOpen);
                });
            });
            
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const rate = parseFloat(btn.dataset.rate);
                    currentCurrency = currencies[btn.dataset.currency] || '‚ÇΩ';
                    document.querySelectorAll('.currency-symbol').forEach(el => el.textContent = currentCurrency);
                    document.getElementById('interest-rate').value = rate;
                    document.getElementById('interest-rate-range').value = rate;
                    calculate();
                });
            });
            
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    updateTable();
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            setupInputs();
            calculate();
            if (window.i18n) i18n.updatePage();
        });
    })();
    </script>
</body>
</html>
